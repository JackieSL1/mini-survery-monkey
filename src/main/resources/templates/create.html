<!DOCTYPE HTML>
<html xmlns:th="https://www.thymeleaf.org">
    <head>
        <title th:text="|Edit survey ${survey.getTitle()}|">Edit survey</title>
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
        <link rel="stylesheet" type="text/css" media="all"
              href="/css/style.css" th:href="@{/css/style.css}">
    </head>
    <body>
        <p><a href="../home">Home</a></p>

        <!-- Update survey title -->
        <form method="post"
              th:action="@{/create/{id}/update(id=${survey.getId()})}"
              th:object="${survey}">
            <p>Title:<br><input th:field="*{title}" type="text"/></p>
            <p><input type="submit" value="Save"/></p>
        </form>

        <!-- Survey questions -->
        <h3>Questions</h3>
        <ul>
            <li th:each="question : ${survey.questions}">
                <!-- Save question -->
                <form method="post"
                      th:action="@{/create/{surveyID}/question/{questionID}/update(surveyID=${survey.getId()}, questionID=${question.id})}">
                    <input type="text" name="newQuestionText" placeholder="Edit question" th:value="${question.question}" />
                    <input type="submit" value="Save" />
                </form>

                <!-- Delete question -->
                <form method="post"
                      th:action="@{/create/{surveyID}/question/{questionID}/delete(surveyID=${survey.getId()}, questionID=${question.id})}">
                    <input type="submit" value="Delete" onclick="return confirm('Are you sure you want to delete this question?');"/>
                </form>

                <!-- Render scale for ScaleQuestion -->
                <div th:if="${question.class.simpleName == 'ScaleQuestion'}">
                    <!-- Render scale below Save/Delete -->
                    <div>
                        <div style="display: flex; justify-content: space-between; width: 100%; margin: 10px 0;">
                            <span th:text="${question.minValue}">1</span>
                            <div style="flex-grow: 1; display: flex; justify-content: space-evenly;">
                                <input type="radio" th:id="'scale-' + ${question.id} + '-' + ${i}"
                                       th:name="'scale-' + ${question.id}" th:value="${i}"
                                       th:each="i : ${#numbers.sequence(question.minValue, question.maxValue)}">
                            </div>
                            <span th:text="${question.maxValue}">10</span>
                        </div>
                    </div>
                </div>

            </li>
        </ul>
        
        <!-- Add new question to survey -->
        <form method="post"
              th:action="@{/create/{id}/question(id=${survey.getId()})}">
            <p><button type="submit" value="Add Question">Add question</button></p>
        </form>

        <!-- Add scale question -->
        <form method="post"
              th:action="@{/create/{id}/scale-question(id=${survey.getId()})}">
            <p><button type="submit">Add Scale Question</button></p>
        </form>


        <!-- Open survey title -->
        <form method="post"
              th:action="@{/create/{id}/open(id=${survey.getId()})}"
              th:object="${survey}">
            <p><input type="submit" value="Collect Responses"/></p>
        </form>




    </body>
</html>


